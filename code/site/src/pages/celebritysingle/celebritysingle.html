<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7 no-js" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8 no-js" lang="en-US">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html lang="it" class="no-js">

<head>
	<!-- Basic need -->
	<title>MovieMania</title>
	<meta charset="UTF-8">
	<meta name="description" content="">
	<meta name="keywords" content="">
	<meta name="author" content="">
	<link rel="profile" href="../profilo/profilo.php">

	<!--Google Font-->
	<link rel="stylesheet" href='http://fonts.googleapis.com/css?family=Dosis:400,700,500|Nunito:300,400,600' />
	<!-- Mobile specific meta -->
	<meta name=viewport content="width=device-width, initial-scale=1">
	<meta name="format-detection" content="telephone-no">

	<!-- CSS files -->
	<link rel="stylesheet" href="../../css/plugins.css">
	<link rel="stylesheet" href="../../css/style.css">

</head>

<body>
	<!--preloading-->
	<div id="preloader">
		<img class="logo" src="../../images/logo1.png" alt="" width="119" height="58">
		<div id="status">
			<span></span>
			<span></span>
		</div>
	</div>
	<!--end of preloading-->
	<!--login form popup-->
	<div class="login-wrapper" id="login-content">
		<div class="login-content">
			<a class="close">x</a>
			<h3>Accedi</h3>
			<form method="post" action="../service/login.php" id="login-form">
				<div class="row">
					<label for="username">
						Username o email:
						<input type="text" name="username" id="username" />
					</label>
				</div>

				<div class="row">
					<label for="password">
						Password:
						<input type="password" name="password" id="password" />
					</label>
				</div>
				<p id="login-error-message" class="error"></p>
				<div class="row">
					<button type="submit">Accedi</button>
				</div>
			</form>
		</div>
	</div>
	<script>
		document.getElementById('login-form').addEventListener('submit', function (event) {
			event.preventDefault();

			var username = document.getElementById('username').value;
			var password = document.getElementById('password').value;

			fetch('../service/login.php', {
				method: 'POST',
				body: new URLSearchParams({ username: username, password: password })
			})
				.then(response => response.json())
				.then(data => {
					if (data.success) {
						// Login riuscito, ricarica la pagina
						window.location.reload();
					} else {
						// Login fallito, mostra il messaggio di errore
						document.getElementById('login-error-message').style.visibility = 'visible';
						document.getElementById('login-error-message').textContent = data.message;
						document.getElementById('password').value = '';
					}
				})
				.catch(error => {
					console.error('Errore durante la richiesta di login:', error);
					// Gestisci l'errore in base alle tue esigenze
				});
		});

		var usernameInput = document.getElementById('username');
		var passwordInput = document.getElementById('password');

		usernameInput.addEventListener('input', hideErrorMessage);
		passwordInput.addEventListener('input', hideErrorMessage);

		function hideErrorMessage() {
			document.getElementById('login-error-message').style.visibility = 'hidden';
		}
	</script>

	<!--end of login form popup-->
	<!--signup form popup-->
	<div class="login-wrapper" id="signup-content">
		<div class="login-content">
			<a class="close">x</a>
			<h3>Registrazione</h3>
			<form method="post" action="../service/signup.php" id="signup-form">
				<div class="row social-btn-2">
					<label for="name">
						Nome:
						<input type="text" name="name" id="name" required="required" />
					</label>
					<div style="width: 10px;"></div>
					<label for="surname">
						Cognome:
						<input type="text" name="surname" id="surname" required="required" />
					</label>
				</div>

				<div class="row social-btn-2">
					<label for="username-2">
						Username:
						<input type="text" name="username" id="username-2" pattern="^[a-zA-Z][a-zA-Z0-9-_\.]{8,20}$"
							required="required" />
					</label>
					<div style="width: 10px;"></div>
					<label for="email-2">
						Email:
						<input type="text" name="email" id="email-2" pattern="[a-z0-9._%+\-]+@[a-z0-9.\-]+\.[a-z]{2,}$"
							required="required" />
					</label>
				</div>
				<div class="row">
					<label for="password-2">
						Password:
						<input type="password" name="password" id="password-2" required="required" />
					</label>
				</div>
				<div class="row">
					<label for="repassword-2">
						Conferma Password:
						<input type="password" name="password" id="repassword-2" required="required" />
					</label>
				</div>
				<p id="signup-error-message" class="error"></p>
				<div class="row">
					<button type="submit">Registrati</button>
				</div>
			</form>
		</div>
	</div>
	<script>
		document.getElementById('signup-form').addEventListener('submit', function (event) {
			event.preventDefault();

			var nome = document.getElementById('name').value;
			var cognome = document.getElementById('surname').value;
			var username = document.getElementById('username-2').value;
			var email = document.getElementById('email-2').value;
			var password = document.getElementById('password-2').value;
			var repassword = document.getElementById('repassword-2').value;

			if (password !== repassword) {
				document.getElementById('signup-error-message').textContent = 'Le password non corrispondono';
				document.getElementById('signup-error-message').style.visibility = 'visible';
				return;
			}

			fetch('../service/signup.php', {
				method: 'POST',
				body: new URLSearchParams({ nome: nome, cognome: cognome, username: username, email: email, password: password })
			})
				.then(response => response.json())
				.then(data => {
					if (data.success) {
						// Registrazione riuscita
						window.location.reload();
					} else {
						// Registrazione fallita, mostra il messaggio di errore
						document.getElementById('signup-error-message').textContent = data.message;
						document.getElementById('signup-error-message').style.visibility = 'visible';
					}
				})
				.catch(error => {
					console.error('Errore durante la richiesta di registrazione:', error);
					// Gestisci l'errore in base alle tue esigenze
				});
		});

		// Aggiungi event listener agli input per nascondere il messaggio d'errore
		var nomeInput = document.getElementById('name');
		var cognomeInput = document.getElementById('surname');
		var usernameInput = document.getElementById('username-2');
		var emailInput = document.getElementById('email-2');
		var passwordInput = document.getElementById('password-2');
		var repasswordInput = document.getElementById('repassword-2');

		nome.addEventListener('input', hideErrorMessage);
		cognome.addEventListener('input', hideErrorMessage);
		usernameInput.addEventListener('input', hideErrorMessage);
		emailInput.addEventListener('input', hideErrorMessage);
		passwordInput.addEventListener('input', hideErrorMessage);
		repasswordInput.addEventListener('input', hideErrorMessage);

		function hideErrorMessage() {
			document.getElementById('signup-error-message').style.visibility = 'hidden';
		}
	</script>
	<!--end of signup form popup-->

	<!-- BEGIN | Header -->
	<header class="ht-header">
		<div class="container">
			<nav class="navbar navbar-default navbar-custom">
				<!-- Brand and toggle get grouped for better mobile display -->
				<div class="navbar-header logo">
					<div class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
						<span class="sr-only">Toggle navigation</span>
						<div id="nav-icon1">
							<span></span>
							<span></span>
							<span></span>
						</div>
					</div>
					<a href="../../index.php">
						<img class="logo" src="../../images/logo1.png" alt="" width="119" height="58">
					</a>
				</div>
				<!-- Collect the nav links, forms, and other content for toggling -->
				<div class="collapse navbar-collapse flex-parent" id="bs-example-navbar-collapse-1">
					<ul class="nav navbar-nav flex-child-menu menu-left">
						<li class="hidden">
							<a href="#page-top"></a>
						</li>
						<li><a href="../../index.php">Home</a></li>
						<li><a href="../../index.php"> File & Serie </a></li>
						<li><a href="../../index.php"> Celebrità </a></li>
					</ul>
					<ul class="nav navbar-nav flex-child-menu menu-right">
						<?php 
                            if($utente == null) {
                                echo '<li class="loginLink"><a>Accedi</a></li>';
                                echo '<li class="btn signupLink"><a>Registrati</a></li>';
                            } else {
                                if ($utente['foto'] != null) {
                                    echo '<img src="data:image/jpeg;base64,' . base64_encode($utente['foto']) . '" alt="" width="40" height="40">';
                                } else {
                                    echo '<img src="../../images/uploads/user.jpg" alt="" width="40" height="40">';
                                }
                                echo '<li><a href="../profilo/profilo.php">' . $utente['nome'] . '</a></li>';
                                echo '<li><a href="../service/logout.php">Disconetti</a></li>';
                            }
                        ?>
					</ul>
				</div>
				<!-- /.navbar-collapse -->
			</nav>

			<!-- top search form -->
			<div class="top-search">
				<select>
					<option value="film">Film</option>
					<option value="serie">Serie</option>
					<option value="celebrita">Celebrità</option>
				</select>
				<input type="text" placeholder="Scrivi il nome di un film, una serie o una celebrità che stai cercando">
			</div>
		</div>
	</header>
	<!-- END | Header -->

	<div class="hero hero3">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
				</div>
			</div>
		</div>
	</div>
	<!-- celebrity single section-->

	<div class="page-single movie-single cebleb-single">
		<div class="container">
			<div class="row ipad-width">
				<div class="col-md-4 col-sm-12 col-xs-12">
					<div class="mv-ceb">
						<?php
							if ($personaggio['foto'] != null) {
							echo '<img src="data:image/jpeg;base64,' . base64_encode($personaggio['foto']) . '" alt=""
								width="340" height="490">';
							} else {
							echo '<img src="../../images/uploads/slider1.jpg" alt="" width="340" height="490">';
							}
						?>
					</div>
				</div>
				<div class="col-md-8 col-sm-12 col-xs-12">
					<div class="movie-single-ct">
						<h1 class="bd-hd">
							<?php echo $personaggio['nome'] . " " . $personaggio['cognome'] ?>
						</h1>
						<p class="ceb-single">
							<?php echo implode(' | ', $ruoli); ?>
						</p>
						<div class="movie-tabs">
							<div class="tabs">
								<ul class="tab-links tabs-mv">
									<li class="active"><a href="#overviewceb">Panoramica</a></li>
									<li><a href="#biography"> Biografia</a></li>
									<li><a href="#filmography">Filmografia</a></li>
								</ul>
								<div class="tab-content">
									<div id="overviewceb" class="tab active">
										<div class="row">
											<div class="col-md-8 col-sm-12 col-xs-12">
												<p>
													<?php echo troncaStringa($personaggio['biografia'], 400) ;?>
												</p>
												<p class="time">
													<a href="#biography" class=" link-to-tab">Vedi tutta la biografia
														<i class="ion-ios-arrow-right"></i>
													</a>
												</p>
												<div class="title-hd-sm">
													<h4>Filmografia</h4>
													<a href="#filmography" class="time  link-to-tab">Vedi tutta la
														filmografia<i class="ion-ios-arrow-right"></i></a>
												</div>
												<!-- movie cast -->
												<div class="mvcast-item">
													<?php 
														for ($i = 0; $i<MIN(5, count($filmografia)); $i++) {
															$programma = $filmografia[$i];
													?>
													<div class="cast-it">
														<div class="cast-left cebleb-film">
															<?php
																if ($programma['copertina'] != null) {
																	echo '<img src="data:image/jpeg;base64,' . base64_encode($programma['copertina']) . '" alt=""
																		width="50" height="90">';
																} else {
																	echo '<img src="../../images/uploads/slider1.jpg" alt="" width="50" height="90">';
																}
															?>
															<div>
																<a href="
																	<?php 
																		if($programma['tipo'] == 'Film'){
																			echo '../moviesingle/moviesingle.php?id=' . $programma['id'];
																		}
																		else{
																			echo '../seriessingle/seriessingle.php?id=' . $programma['id'];
																		}
																	?>">
																	<?php echo $programma['titolo'] ?>
																</a>
																<p class="time" style="min-width: 100px;">
																	<?php 
																		if($programma['interpreta'] != null){
																		echo $programma['interpreta'];
																	}?>
																</p>
															</div>

														</div>
														<p>
															<?php echo "... " . $programma['ruolo'] ?>
														</p>
													</div>
													<?php } ?>
												</div>
											</div>
											<div class="col-md-4 col-xs-12 col-sm-12">
												<div class="sb-it">
													<h6>Data di nascita: </h6>
													<p>
														<?php 
															$date = new DateTime($personaggio['data_nascita']);
                                                            $date_formatter = new IntlDateFormatter('it_IT', IntlDateFormatter::LONG, IntlDateFormatter::NONE);
                                                            $formatted_date = $date_formatter->format($date);
                                                            echo $formatted_date;
														?>
													</p>
												</div>
												<div class="sb-it">
													<h6>Nazione: </h6>
													<p>
														<?php echo $personaggio['nazionalita']  ?>
													</p>
												</div>
												<div class="sb-it">
													<h6>Altezza:</h6>
													<p>
														<?php echo $personaggio['altezza'] . ' m' ?>
													</p>
												</div>
											</div>
										</div>
									</div>
									<div id="biography" class="tab">
										<div>
											<h3>Biografia di</h3>
											<h2>
												<?php echo $personaggio['nome'] . " " . $personaggio['cognome'] ?>
											</h2>
										</div>
										<div class="row">
											<div class="rv-hd">
												<p style="padding-right: 20px;">
													<?php echo $personaggio['biografia'] ?>
												</p>
											</div>
										</div>
									</div>
									<div id="filmography" class="tab">
										<div class="row">
											<div class="rv-hd">
												<div>
													<h3>Filmografia di </h3>
													<h2>
														<?php echo $personaggio['nome'] . " " . $personaggio['cognome'] ?>
													</h2>
												</div>
											</div>
											<!-- movie cast -->
											<div class="mvcast-item">
												<?php foreach ($filmografia as $programma){ ?>
												<div class="cast-it">
													<div class="cast-left cebleb-film">
														<?php
															if ($programma['copertina'] != null) {
																echo '<img src="data:image/jpeg;base64,' . base64_encode($programma['copertina']) . '" alt=""
																	width="50" height="90">';
															} else {
																echo '<img src="../../images/uploads/slider1.jpg" alt="" width="50" height="90">';
															}
														?>
														<div>
															<a href="
																<?php 
																	if($programma['tipo'] == 'Film'){
																		echo '../moviesingle/moviesingle.php?id=' . $programma['id'];
																	}
																	else{
																		echo '../seriessingle/seriessingle.php?id=' . $programma['id'];
																	}
																?>">
																<?php echo $programma['titolo'] ?>
															</a>
															<p class="time" style="min-width: 100px;">
																<?php 
																	if($programma['interpreta'] != null){
																	echo $programma['interpreta'];
																}?>
															</p>
														</div>

													</div>
													<p>
														<?php echo "... " . $programma['ruolo'] ?>
													</p>
												</div>
												<?php } ?>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- celebrity single section-->

	<!-- footer section-->
	<footer class="ht-footer">
		<div class="container">
			<div class="flex-parent-ft">
				<div class="flex-child-ft item1">
					<a href="index.html"><img class="logo" src="../../images/logo1.png" alt=""></a>
					<p>5th Avenue st, manhattan<br>
						New York, NY 10001</p>
					<p>Call us: <a href="#">(+01) 202 342 6789</a></p>
				</div>
				<div class="flex-child-ft item2">
					<h4>Resources</h4>
					<ul>
						<li><a href="#">About</a></li>
						<li><a href="#">Blockbuster</a></li>
						<li><a href="#">Contact Us</a></li>
						<li><a href="#">Forums</a></li>
						<li><a href="#">Blog</a></li>
						<li><a href="#">Help Center</a></li>
					</ul>
				</div>
				<div class="flex-child-ft item3">
					<h4>Legal</h4>
					<ul>
						<li><a href="#">Terms of Use</a></li>
						<li><a href="#">Privacy Policy</a></li>
						<li><a href="#">Security</a></li>
					</ul>
				</div>
				<div class="flex-child-ft item4">
					<h4>Account</h4>
					<ul>
						<li><a href="#">My Account</a></li>
						<li><a href="#">Watchlist</a></li>
						<li><a href="#">Collections</a></li>
						<li><a href="#">User Guide</a></li>
					</ul>
				</div>
				<div class="flex-child-ft item5">
					<h4>Newsletter</h4>
					<p>Subscribe to our newsletter system now <br> to get latest news from us.</p>
					<form action="#">
						<input type="text" placeholder="Enter your email...">
					</form>
					<a href="#" class="btn">Subscribe now <i class="ion-ios-arrow-forward"></i></a>
				</div>
			</div>
		</div>
		<div class="ft-copyright">
			<div class="ft-left">
				<p>© 2017 Blockbuster. All Rights Reserved. Designed by leehari.</p>
			</div>
			<div class="backtotop">
				<p><a href="#" id="back-to-top">Back to top <i class="ion-ios-arrow-thin-up"></i></a></p>
			</div>
		</div>
	</footer>
	<!-- end of footer section-->

	<script src="../../js/jquery.js"></script>
	<script src="../../js/plugins.js"></script>
	<script src="../../js/plugins2.js"></script>
	<script src="../../js/custom.js"></script>
</body>

</html>